# source_code
## Workflow: 
### Crawling and Post-processing
We followed the instructions in [VisibleV8](https://github.com/wspr-ncsu/visiblev8) to install VV8. Combining VV8 with a crawler, we collected crawling data and stored it in PostgreSQL. Here is the [crawling data](https://drive.google.com/file/d/18AYXCa-zGFjAoniQ0P9qncJzBx5d0iA5/view?usp=sharing). Post-processing is done during crawling and the code is inside the [vv8-post-processor directory](https://github.com/jsu6/source_code/tree/main/vv8-post-processor). Note: the vv8-post-processor provided by us is different from the one in public [vv8-post-processor](https://github.com/wspr-ncsu/visiblev8/tree/master/post-processor) Github repo. The difference is that the public vv8-post-processor does not preserve the sequence of API calls when processing the crawling data. That is the major reason we built a new vv8-post-processor that reserves the sequence of API calls to fulfill the locality needs in our research. We provide our vv8-post-processor [executable](https://drive.google.com/file/d/1Z-BqdLgzIr1KHwd13aT8C8_QBIV3Dk16/view?usp=sharing) and the [crawling data table](https://github.com/jsu6/source_code/blob/main/vv8-post-processor/mega/postgres_schema.sql#L96-L103) used in PostgreSQL. 
### Locality Algorithm
[local_cal.py](https://github.com/jsu6/source_code/blob/main/analysis-source-code/local_cal.py) includes the main logic of the locality algorithm.
[FPanalysis.py](https://github.com/jsu6/source_code/blob/main/analysis-source-code/FPanalysis.py) includes the main logic of dynamic analysis. It connects to PostgreSQL that stores [crawling data](https://drive.google.com/file/d/18AYXCa-zGFjAoniQ0P9qncJzBx5d0iA5/view?usp=sharing) and conducts locality algorithm on APIs in table element ["APIs"](https://github.com/jsu6/source_code/blob/main/vv8-post-processor/mega/postgres_schema.sql#L102). Then, it inserts the dynamic analysis results in another database(we provide it [here](https://drive.google.com/file/d/1ao-4gabio8lxFYKf85lSdFp0nyb5xXY9/view?usp=sharing) with the format mentioned in this [table](https://github.com/jsu6/source_code/blob/main/vv8-post-processor/mega/postgres_schema.sql#L105-L110)). The command we used to run dynamic analysis is 
`python3 FPanalysis.py FPLOI 1`.
### Static Analysis
The static analysis takes the results of the locality algorithm as input and stores them in a temporary file. Then, it builds a pdg based on the temporary file and search for data flow in pdg. We only used functionality in [pdg_generation](https://github.com/Aurore54F/JStap/tree/master/pdg_generation) from [JStap](https://github.com/Aurore54F/JStap). These files are in [analysis-source-code](https://github.com/jsu6/source_code/tree/main/analysis-source-code). [FPstatic.py](https://github.com/jsu6/source_code/blob/main/analysis-source-code/FPstatic.py) and [statictest.py](https://github.com/jsu6/source_code/blob/main/analysis-source-code/statictest.py) include the main logic of static analysis. The command we used to run static analysis is 
`python3 statictest.py`.
### Example
The above data is obtained by calling the command `pg_dump DATABASE | gzip > DATABASE.gz` and it is the result of crawling the Alexa Top 10K websites. It's not easy to read or comprehend. For convenience, we also provide corresponding [easy crawling data](https://drive.google.com/file/d/1rQkdd-GptaHGrh191sn5hpkmJ4adsS2h/view?usp=sharing), [easy locality_results](https://drive.google.com/file/d/1gsovvsqS3Iduid0Q8-XCjh2u8k2CUjqD/view?usp=sharing), [VV8 raw log](https://drive.google.com/file/d/1OIra2qskqWVpgLYWWyG7cyL7fVctE1YP/view?usp=sharing) by only crawling [ebay](https://www.ebay.com/).
